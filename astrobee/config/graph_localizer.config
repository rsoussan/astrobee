-- Copyright (c) 2017, United States Government, as represented by the
-- Administrator of the National Aeronautics and Space Administration.
--
-- All rights reserved.
--
-- The Astrobee platform is licensed under the Apache License, Version 2.0
-- (the "License"); you may not use this file except in compliance with the
-- License. You may obtain a copy of the License at
--
--     http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
-- WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
-- License for the specific language governing permissions and limitations
-- under the License.

-- Graph Value Options
ideal_duration = 2 
--  Don't leave less than min_num_states in window if possible
min_num_states = 3
max_num_states = 100
-- Graph Options
max_iterations = 15 
-- cholesky (faster but less robust) or qr (slower but more robust)
marginals_factorization = "qr"
-- 62.5 measurements per second
num_bias_estimation_measurements = 100 
limit_imu_factor_spacing = false 
max_imu_factor_spacing = 0.1
loc_nav_cam_noise_stddev = 0.1
optical_flow_nav_cam_noise_stddev = 0.1
loc_dock_cam_noise_stddev = 0.1
-- Hack since proper marginalization doesn't work well with smart factors and current marginalization priors
-- don't carry enough weight since smart factors don't always extend to oldest states being marginalized
priors_scale_factor = 1
-- Only applicable for non zero gravity, causes gravity to be detected as an accelerometer bias instead of 
-- subtracted from accelerometer measurements which requires the use of global orientation estimates.
-- Only works when robot is always gravity aligned.  Recommended when testing in the lab.
ignore_gravity = true 
-- Sanity Checker options
-- TODO(rsoussan): Create seperate config for sanity checker?
check_pose_difference = true 
num_consecutive_pose_difference_failures_until_insane = 3 
max_sane_position_difference = 10 
check_position_covariance = false 
check_orientation_covariance = false
position_covariance_threshold = 0
orientation_covariance_threshold = 0
-- Starting Prior Noise
starting_prior_translation_stddev = 0.02
starting_prior_quaternion_stddev = 0.01
starting_prior_velocity_stddev = 0.01
starting_prior_accel_bias_stddev = 0.001
starting_prior_gyro_bias_stddev = 0.001
-- Lost Threshold
position_cov_log_det_lost_threshold = 0
orientation_cov_log_det_lost_threshold = 0
-- Feature Tracker
feature_tracker_sliding_window_duration = 1.0 
-- Optical Flow Factors 
-- Gives min threshold for distance traveled for optical flow tracks to avoid degenerate cases with no/too small of baseline
min_valid_feature_track_avg_distance_from_mean = 0.075
max_standstill_feature_track_avg_distance_from_mean = 0.075
optical_flow_prior_velocity_stddev = 0.01
optical_flow_standstill_velocity_prior = true 
enable_EPI = false 
landmark_distance_threshold = 500
dynamic_outlier_rejection_threshold = 50 
retriangulation_threshold = 1e-5
verbose_cheirality = false 
robust_smart_factor = true 
max_num_optical_flow_factors = 25 
-- zero_on_degeneracy or handle_infinity
degeneracy_mode = "zero_on_degeneracy"
-- jacobian_svd or hessian
-- If hessian, be careful of gtsam indeterminant linear system warning, 
-- increase min_valid_feature_track_avg_distance_from_mean to combat this
linearization_mode = "jacobian_svd"
-- Loc Projection Factors
loc_pose_priors = true 
loc_projections = false 
loc_prior_translation_stddev = 0.01
loc_prior_quaternion_stddev = 0.01
min_num_matches = 5
-- Imu integration
-- butter, butter3, butter5, butter5_1, butter5_05, none
imu_filter = "butter"
imu_augmentor_standstill = true
-- From gtsam: Angular and velocity random walk expressed in degrees respectively m/s per sqrt(hr)
-- (0.5 * M_PI / 180) / 60;  // 0.5 degree ARW
gyro_sigma = 0.00001    
-- 0.1 / 60; // 10 cm VRW
accel_sigma = 0.000001  
accel_bias_sigma = 0.01
gyro_bias_sigma = 0.001
integration_variance = 0.0001
bias_acc_omega_int = 0.0001
-- Other
verbose = false 
fatal_failures = true
print_factor_info = false 
use_ceres_params = false 
publish_localization_graph = false 
save_localization_graph_dot_file = false 
